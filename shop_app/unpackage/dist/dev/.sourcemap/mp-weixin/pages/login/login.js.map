{"version":3,"file":"login.js","sources":["pages/login/login.vue","../../../application/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <view class=\"title\">欢迎登录</view>\n    <view class=\"form-item\">\n      <input class=\"input\" v-model=\"username\" placeholder=\"请输入用户名\" />\n    </view>\n    <view class=\"form-item\">\n      <input class=\"input\" type=\"password\" v-model=\"password\" placeholder=\"请输入密码\" />\n    </view>\n    <button class=\"btn\" @click=\"handleLogin\">账号密码登录</button>\n    <view class=\"other-login-title\">或</view>\n    <button class=\"btn wx-btn\" @click=\"handleWxLogin\">微信一键登录</button>\n    <view class=\"link\" @click=\"goToRegister\">没有账号？去注册</view>\n  </view>\n</template>\n\n<script>\nimport { login, wechatLogin } from '@/api/auth';\n\nexport default {\n  data() {\n    return {\n      username: '',\n      password: ''\n    };\n  },\n  methods: {\n    async handleLogin() {\n      if (!this.username || !this.password) {\n        uni.showToast({ title: '请填写完整', icon: 'none' });\n        return;\n      }\n      try {\n        const res = await login({ username: this.username, password: this.password });\n        uni.setStorageSync('token', res.token);\n        uni.setStorageSync('user', res.user);\n        uni.showToast({ title: '登录成功' });\n        \n        // 调用 App.vue 的方法更新 tabBar\n        const app = getApp();\n        app.checkLoginStatus();\n        \n        setTimeout(() => {\n          uni.switchTab({ url: '/pages/index/index' });\n        }, 1500);\n      } catch (error) {\n        console.error(error);\n      }\n    },\n    async handleWxLogin() {\n      uni.showLoading({ title: '登录中...', mask: true });\n      uni.getUserInfo({\n        provider: 'weixin',\n        success: (userRes) => {\n          console.log(userRes);\n          const userInfo = userRes.userInfo || {};\n          const nickname = userInfo.nickName || '';\n          const avatarUrl = userInfo.avatarUrl || '';\n          uni.login({\n            provider: 'weixin',\n            success: async (loginRes) => {\n              console.log(loginRes);\n              try {\n                const { data } = await wechatLogin({\n                  code: \"0b36vpll24RWPg4aNTkl2z0WCk06vplt\",\n                  nickname,\n                  avatar_url: avatarUrl\n                });\n                uni.setStorageSync('token', data.token);\n                uni.setStorageSync('user', data.user);\n                const app = getApp();\n                if (app && app.checkLoginStatus) {\n                  app.checkLoginStatus();\n                }\n                uni.hideLoading();\n                uni.showToast({ title: '登录成功' });\n                setTimeout(() => {\n                  uni.switchTab({ url: '/pages/index/index' });\n                }, 1500);\n              } catch (err) {\n                uni.hideLoading();\n                console.error(err);\n                uni.showToast({ title: '微信登录失败', icon: 'none' });\n              }\n            },\n            fail: (err) => {\n              uni.hideLoading();\n              console.error(err);\n              uni.showToast({ title: '微信登录失败', icon: 'none' });\n            }\n          });\n        },\n        fail: (err) => {\n          uni.hideLoading();\n          console.error(err);\n          uni.showToast({ title: '微信授权失败', icon: 'none' });\n        }\n      });\n    },\n    goToRegister() {\n      uni.navigateTo({ url: '/pages/register/register' });\n    }\n  }\n};\n</script>\n\n<style>\n.container { padding: 50px 20px; }\n.title { font-size: 24px; font-weight: bold; margin-bottom: 30px; text-align: center; }\n.form-item { margin-bottom: 20px; border-bottom: 1px solid #eee; padding: 10px 0; }\n.input { width: 100%; }\n.btn { background-color: #3cc51f; color: #fff; margin-top: 30px; }\n.wx-btn { background-color: #07c160; margin-top: 15px; }\n.other-login-title { text-align: center; margin-top: 20px; color: #999; font-size: 14px; }\n.link { text-align: center; margin-top: 20px; color: #666; font-size: 14px; }\n</style>\n","import MiniProgramPage from 'D:/projects/my_shop/shop_app/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","login","wechatLogin"],"mappings":"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"}
{"version":3,"file":"cart.js","sources":["pages/cart/cart.vue","../../../application/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2FydC9jYXJ0LnZ1ZQ"],"sourcesContent":["<template>\r\n    <view class=\"container\">\r\n        <view v-if=\"!isLogin\" class=\"login-prompt\">\r\n            <view class=\"prompt-icon\">üîí</view>\r\n            <view class=\"prompt-text\">ËØ∑ÂÖàÁôªÂΩïÊü•ÁúãË¥≠Áâ©ËΩ¶</view>\r\n            <button class=\"login-btn\" @click=\"goToLogin\">ÂéªÁôªÂΩï</button>\r\n        </view>\r\n        \r\n        <view v-else>\r\n            <view v-if=\"cartList.length === 0\" class=\"empty-cart\">\r\n                <view class=\"empty-icon\">üõí</view>\r\n                <view class=\"empty-text\">Ë¥≠Áâ©ËΩ¶‰∏∫Á©∫</view>\r\n            </view>\r\n            \r\n            <view v-else class=\"cart-list\">\r\n                <view class=\"cart-item\" v-for=\"item in cartList\" :key=\"item.id\">\r\n                    <image class=\"product-img\" :src=\"filePath + (item.Product.image_url || '/uploads/logo.png')\" mode=\"aspectFill\"></image>\r\n                    <view class=\"product-info\">\r\n                        <view class=\"product-name\">{{ item.Product.name }}</view>\r\n                        <view class=\"product-price\">¬•{{ item.Product.price }}</view>\r\n                        <view class=\"quantity-control\">\r\n                            <view class=\"btn-minus\" @click=\"updateQuantity(item, -1)\">-</view>\r\n                            <view class=\"quantity\">{{ item.quantity }}</view>\r\n                            <view class=\"btn-plus\" @click=\"updateQuantity(item, 1)\">+</view>\r\n                        </view>\r\n                    </view>\r\n                    <view class=\"delete-btn\" @click=\"removeItem(item.id)\">Âà†Èô§</view>\r\n                </view>\r\n            </view>\r\n            \r\n            <view v-if=\"cartList.length > 0\" class=\"footer\">\r\n                <view class=\"total-price\">ÊÄªËÆ°: ¬•{{ totalPrice }}</view>\r\n                <view class=\"checkout-btn\" @click=\"checkout\">ÂéªÁªìÁÆó</view>\r\n            </view>\r\n        </view>\r\n    </view>\r\n</template>\r\n\r\n<script>\r\nimport { getCart, updateCartItem, removeCartItem } from '@/api/cart';\r\nimport { createOrder } from '@/api/order';\r\nimport { filePath } from '@/utils/request';\r\n\r\nexport default {\r\n    data() {\r\n        return {\r\n            cartList: [],\r\n            filePath,\r\n            isLogin: false\r\n        };\r\n    },\r\n    onShow() {\r\n        this.checkLoginStatus();\r\n        if (this.isLogin) {\r\n            this.loadCart();\r\n        }\r\n    },\r\n    computed: {\r\n        totalPrice() {\r\n            return this.cartList.reduce((total, item) => {\r\n                return total + item.Product.price * item.quantity;\r\n            }, 0).toFixed(2);\r\n        }\r\n    },\r\n    methods: {\r\n        checkLoginStatus() {\r\n            const token = uni.getStorageSync('token');\r\n            this.isLogin = !!token;\r\n        },\r\n        goToLogin() {\r\n            uni.navigateTo({ url: '/pages/login/login' });\r\n        },\r\n        async loadCart() {\r\n            try {\r\n                const res = await getCart();\r\n                this.cartList = res.data;\r\n            } catch (error) {\r\n                console.error(error);\r\n            }\r\n        },\r\n        async updateQuantity(item, change) {\r\n            const newQuantity = item.quantity + change;\r\n            if (newQuantity < 1) return;\r\n            try {\r\n                await updateCartItem(item.id, { quantity: newQuantity });\r\n                item.quantity = newQuantity;\r\n            } catch (error) {\r\n                console.error(error);\r\n            }\r\n        },\r\n        async removeItem(id) {\r\n            try {\r\n                await removeCartItem(id);\r\n                this.loadCart();\r\n            } catch (error) {\r\n                console.error(error);\r\n            }\r\n        },\r\n        async checkout() {\r\n            if (this.cartList.length === 0) {\r\n                uni.showToast({ title: 'Ë¥≠Áâ©ËΩ¶‰∏∫Á©∫', icon: 'none' });\r\n                return;\r\n            }\r\n            try {\r\n                // Hardcoded address_id for demo purposes, assuming user has address 1\r\n                // Or we can prompt user to enter address or select one.\r\n                // For now, let's just try to create order and see if it works or fails (if address is required)\r\n                // The API requires address_id.\r\n                // I'll just pass 1 for now or handle error.\r\n                await createOrder({ address_id: 1, remark: 'Êù•Ëá™Â∞èÁ®ãÂ∫è' });\r\n                uni.showToast({ title: '‰∏ãÂçïÊàêÂäü' });\r\n                this.loadCart();\r\n                setTimeout(() => {\r\n                    uni.navigateTo({ url: '/pages/order/list' });\r\n                }, 1500);\r\n            } catch (error) {\r\n                console.error(error);\r\n                uni.showToast({ title: '‰∏ãÂçïÂ§±Ë¥•: ' + (error.message || 'Êú™Áü•ÈîôËØØ'), icon: 'none' });\r\n            }\r\n        }\r\n    }\r\n};\r\n</script>\r\n\r\n<style>\r\n.container {\r\n    padding-bottom: 60px;\r\n}\r\n\r\n.cart-item {\r\n    display: flex;\r\n    padding: 10px;\r\n    background-color: #fff;\r\n    margin-bottom: 10px;\r\n    align-items: center;\r\n}\r\n\r\n.product-img {\r\n    width: 80px;\r\n    height: 80px;\r\n    margin-right: 10px;\r\n}\r\n\r\n.product-info {\r\n    flex: 1;\r\n}\r\n\r\n.product-name {\r\n    font-size: 14px;\r\n    margin-bottom: 5px;\r\n}\r\n\r\n.product-price {\r\n    color: #ff0000;\r\n    font-weight: bold;\r\n    margin-bottom: 5px;\r\n}\r\n\r\n.quantity-control {\r\n    display: flex;\r\n    align-items: center;\r\n}\r\n\r\n.btn-minus,\r\n.btn-plus {\r\n    width: 25px;\r\n    height: 25px;\r\n    border: 1px solid #ccc;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n}\r\n\r\n.quantity {\r\n    margin: 0 10px;\r\n}\r\n\r\n.delete-btn {\r\n    color: #ff0000;\r\n    margin-left: 10px;\r\n}\r\n\r\n.footer {\r\n    position: fixed;\r\n    bottom: 50px;\r\n    left: 0;\r\n    right: 0;\r\n    height: 50px;\r\n    background-color: #fff;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    padding: 0 15px;\r\n    border-top: 1px solid #eee;\r\n}\r\n\r\n/* bottom 50px because of tabbar */\r\n.total-price {\r\n    color: #ff0000;\r\n    font-weight: bold;\r\n    font-size: 18px;\r\n}\r\n\r\n.checkout-btn {\r\n    background-color: #ff0000;\r\n    color: #fff;\r\n    padding: 10px 20px;\r\n    border-radius: 20px;\r\n}\r\n\r\n.login-prompt {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    height: 100vh;\r\n    padding: 20px;\r\n}\r\n\r\n.prompt-icon {\r\n    font-size: 64px;\r\n    margin-bottom: 20px;\r\n}\r\n\r\n.prompt-text {\r\n    font-size: 18px;\r\n    color: #333;\r\n    margin-bottom: 30px;\r\n}\r\n\r\n.login-btn {\r\n    background-color: #3cc51f;\r\n    color: #fff;\r\n    padding: 15px 40px;\r\n    border-radius: 6px;\r\n}\r\n\r\n.empty-cart {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding: 100px 20px;\r\n}\r\n\r\n.empty-icon {\r\n    font-size: 64px;\r\n    margin-bottom: 20px;\r\n}\r\n\r\n.empty-text {\r\n    font-size: 16px;\r\n    color: #999;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/projects/my_shop/shop_app/pages/cart/cart.vue'\nwx.createPage(MiniProgramPage)"],"names":["filePath","uni","getCart","updateCartItem","removeCartItem","createOrder"],"mappings":";;;;;AA2CA,MAAK,YAAU;AAAA,EACX,OAAO;AACH,WAAO;AAAA,MACH,UAAU,CAAE;AAAA,MACZ,UAAAA,cAAQ;AAAA,MACR,SAAS;AAAA;EAEhB;AAAA,EACD,SAAS;AACL,SAAK,iBAAgB;AACrB,QAAI,KAAK,SAAS;AACd,WAAK,SAAQ;AAAA,IACjB;AAAA,EACH;AAAA,EACD,UAAU;AAAA,IACN,aAAa;AACT,aAAO,KAAK,SAAS,OAAO,CAAC,OAAO,SAAS;AACzC,eAAO,QAAQ,KAAK,QAAQ,QAAQ,KAAK;AAAA,MAC5C,GAAE,CAAC,EAAE,QAAQ,CAAC;AAAA,IACnB;AAAA,EACH;AAAA,EACD,SAAS;AAAA,IACL,mBAAmB;AACf,YAAM,QAAQC,cAAAA,MAAI,eAAe,OAAO;AACxC,WAAK,UAAU,CAAC,CAAC;AAAA,IACpB;AAAA,IACD,YAAY;AACRA,oBAAAA,MAAI,WAAW,EAAE,KAAK,qBAAsB,CAAA;AAAA,IAC/C;AAAA,IACD,MAAM,WAAW;AACb,UAAI;AACA,cAAM,MAAM,MAAMC,SAAAA;AAClB,aAAK,WAAW,IAAI;AAAA,MACtB,SAAO,OAAO;AACZD,sBAAAA,MAAA,MAAA,SAAA,6BAAc,KAAK;AAAA,MACvB;AAAA,IACH;AAAA,IACD,MAAM,eAAe,MAAM,QAAQ;AAC/B,YAAM,cAAc,KAAK,WAAW;AACpC,UAAI,cAAc;AAAG;AACrB,UAAI;AACA,cAAME,SAAAA,eAAe,KAAK,IAAI,EAAE,UAAU,YAAY,CAAC;AACvD,aAAK,WAAW;AAAA,MAClB,SAAO,OAAO;AACZF,sBAAAA,MAAA,MAAA,SAAA,6BAAc,KAAK;AAAA,MACvB;AAAA,IACH;AAAA,IACD,MAAM,WAAW,IAAI;AACjB,UAAI;AACA,cAAMG,SAAAA,eAAe,EAAE;AACvB,aAAK,SAAQ;AAAA,MACf,SAAO,OAAO;AACZH,sBAAAA,MAAA,MAAA,SAAA,6BAAc,KAAK;AAAA,MACvB;AAAA,IACH;AAAA,IACD,MAAM,WAAW;AACb,UAAI,KAAK,SAAS,WAAW,GAAG;AAC5BA,sBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,OAAK,CAAG;AAC9C;AAAA,MACJ;AACA,UAAI;AAMA,cAAMI,UAAAA,YAAY,EAAE,YAAY,GAAG,QAAQ,QAAQ,CAAC;AACpDJ,sBAAAA,MAAI,UAAU,EAAE,OAAO,OAAQ,CAAA;AAC/B,aAAK,SAAQ;AACb,mBAAW,MAAM;AACbA,wBAAAA,MAAI,WAAW,EAAE,KAAK,oBAAqB,CAAA;AAAA,QAC9C,GAAE,IAAI;AAAA,MACT,SAAO,OAAO;AACZA,sBAAAA,MAAA,MAAA,SAAA,8BAAc,KAAK;AACnBA,sBAAAA,MAAI,UAAU,EAAE,OAAO,YAAY,MAAM,WAAW,SAAS,MAAM,OAAQ,CAAA;AAAA,MAC/E;AAAA,IACJ;AAAA,EACJ;AACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxHA,GAAG,WAAW,eAAe;"}
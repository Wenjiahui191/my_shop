{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["const BASE_URL = 'http://localhost:8088/api';\r\n\r\nconst request = (options) => {\r\n  return new Promise((resolve, reject) => {\r\n    const token = uni.getStorageSync('token');\r\n    const header = {\r\n      'Content-Type': 'application/json',\r\n      ...options.header,\r\n    };\r\n    if (token) {\r\n      header['Authorization'] = `Bearer ${token}`;\r\n    }\r\n\r\n    uni.request({\r\n      url: BASE_URL + options.url,\r\n      method: options.method || 'GET',\r\n      data: options.data || {},\r\n      header: header,\r\n      success: (res) => {\r\n        // 统一的响应结构：{ code, message, data, pagination? }\r\n        const { code, message, data } = res.data;\r\n        \r\n        // 根据响应码判断成功/失败\r\n        if (code >= 200 && code < 300) {\r\n          // 成功：返回data\r\n          resolve({ data, pagination: res.data.pagination || {} });\r\n        } else {\r\n          // 错误处理\r\n          if (code === 401) {\r\n            uni.removeStorageSync('token');\r\n            uni.removeStorageSync('user');\r\n            // Avoid redirect loop if already on login page\r\n            const pages = getCurrentPages();\r\n            const currentPage = pages[pages.length - 1];\r\n            if (currentPage && currentPage.route !== 'pages/login/login') {\r\n                uni.navigateTo({ url: '/pages/login/login' });\r\n            }\r\n          }\r\n          uni.showToast({\r\n            title: message || '请求失败',\r\n            icon: 'none'\r\n          });\r\n          reject({ code, message, data });\r\n        }\r\n      },\r\n      fail: (err) => {\r\n        uni.showToast({\r\n          title: '网络请求失败',\r\n          icon: 'none'\r\n        });\r\n        reject(err);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nexport const filePath=\"http://192.168.3.245:8088\"\r\n\r\nexport default request;\r\n"],"names":["uni"],"mappings":";;AAAA,MAAM,WAAW;AAEZ,MAAC,UAAU,CAAC,YAAY;AAC3B,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,UAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,UAAM,SAAS;AAAA,MACb,gBAAgB;AAAA,MAChB,GAAG,QAAQ;AAAA,IACjB;AACI,QAAI,OAAO;AACT,aAAO,eAAe,IAAI,UAAU,KAAK;AAAA,IAC1C;AAEDA,kBAAAA,MAAI,QAAQ;AAAA,MACV,KAAK,WAAW,QAAQ;AAAA,MACxB,QAAQ,QAAQ,UAAU;AAAA,MAC1B,MAAM,QAAQ,QAAQ,CAAE;AAAA,MACxB;AAAA,MACA,SAAS,CAAC,QAAQ;AAEhB,cAAM,EAAE,MAAM,SAAS,KAAI,IAAK,IAAI;AAGpC,YAAI,QAAQ,OAAO,OAAO,KAAK;AAE7B,kBAAQ,EAAE,MAAM,YAAY,IAAI,KAAK,cAAc,CAAE,EAAA,CAAE;AAAA,QACjE,OAAe;AAEL,cAAI,SAAS,KAAK;AAChBA,gCAAI,kBAAkB,OAAO;AAC7BA,gCAAI,kBAAkB,MAAM;AAE5B,kBAAM,QAAQ;AACd,kBAAM,cAAc,MAAM,MAAM,SAAS,CAAC;AAC1C,gBAAI,eAAe,YAAY,UAAU,qBAAqB;AAC1DA,4BAAAA,MAAI,WAAW,EAAE,KAAK,qBAAsB,CAAA;AAAA,YAC/C;AAAA,UACF;AACDA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO,WAAW;AAAA,YAClB,MAAM;AAAA,UAClB,CAAW;AACD,iBAAO,EAAE,MAAM,SAAS,KAAM,CAAA;AAAA,QAC/B;AAAA,MACF;AAAA,MACD,MAAM,CAAC,QAAQ;AACbA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAChB,CAAS;AACD,eAAO,GAAG;AAAA,MACX;AAAA,IACP,CAAK;AAAA,EACL,CAAG;AACH;AAEY,MAAC,WAAS;;;"}